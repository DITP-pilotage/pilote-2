openapi: 3.1.0
x-stoplight:
  id: x0ygm9j5iky4x
info:
  title: pilote-api
  version: '1.0'
  summary: Cette API permet d'interagir avec Pilote.
  description: 'Via cette API, il est possible de récupérer les données de Pilote et d''importer des données dans la limite des autorisations fixées par votre compte.'
  contact:
    name: Colin DUGEAI
    email: colin.dugeaiATmodernisation.gouv.fr
servers:
  - url: 'http://localhost:3000'
    description: Local
  - url: 'http://172.17.0.1:3000'
    description: Docker local
paths:
  '/ppg/{ppg_id}':
    parameters:
      - schema:
          type: string
          example: PPG-003
          pattern: '^PPG-[0-9][0-9][0-9]$'
          minLength: 7
          maxLength: 7
        name: ppg_id
        in: path
        required: true
        description: Identifiant de la PPG
    get:
      summary: Informations PPG
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PPG'
              examples:
                PPG d'exemple:
                  value:
                    id: PPG-014
                    nom: Première PPG
                    description: Description de la PPG
                    axe_id:
                      id: EMPLOI
      operationId: get-ppg-id
      description: Obtenir les informations sur une PPG
      parameters: []
      tags:
        - PPG
  '/chantier/{chantier_id}':
    parameters:
      - schema:
          type: string
          example: CH-005
          pattern: '^CH-[0-9][0-9][0-9]$'
          minLength: 6
          maxLength: 6
        name: chantier_id
        in: path
        required: true
        description: Identifiant du chantier
    get:
      summary: Informations chantier
      tags:
        - Chantier
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Chantier'
              examples:
                Example 1:
                  value:
                    id: CH-001
                    description: Description textuelle du premier chantier
                    nom: Premier chantier prioritaire
                    directeur_projet: Jean Dupont
                    ppg_id: PPG-123
                    porteurs: MEFSIN | MSAPH
                    perimetre_id: PER-019
                    territorialise: true
                    engagement: EMPLOI
                    etat: PUBLIE
      operationId: get-chantier-id
      description: Obtenir les informations sur un chantier
      parameters: []
    put:
      summary: Modifier un chantier
      operationId: post-chantier-id
      responses:
        '200':
          description: OK
      description: Modifier les informations sur un chantier
      x-internal: true
      tags:
        - Chantier
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Chantier'
  '/indicateur/{indicateur_id}':
    parameters:
      - schema:
          type: string
        name: indicateur_id
        in: path
        required: true
    get:
      summary: Informations indicateur
      tags:
        - Indicateur
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Indicateur'
              examples:
                Example 1:
                  value:
                    id: CH-001
                    description: Description textuelle du premier chantier
                    nom: Premier chantier prioritaire
                    directeur_projet: Jean Dupont
                    ppg_id: PPG-123
                    porteurs: MEFSIN | MSAPH
                    perimetre_id: PER-019
                    territorialise: true
                    engagement: EMPLOI
                    etat: PUBLIE
      operationId: get-indicateur-id
      description: Obtenir les informations sur un indicateur
      parameters: []
    put:
      summary: Modifier un indicateur
      operationId: post-indicateur-id
      responses:
        '200':
          description: OK
      description: Modifier les informations sur un indicateur
      x-internal: true
      tags:
        - Indicateur
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Indicateur'
    post:
      summary: Import données indicateur
      operationId: post-indicateur-indicateur_id
      responses:
        '200':
          description: OK
      description: Ajout de données d'un indicateur
      tags:
        - Indicateur
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                x-stoplight:
                  id: mruq4uoieht0v
                type: object
                properties:
                  zone_id:
                    type: string
                    x-stoplight:
                      id: blgo0owpsk8tc
                    description: Zone concernée par la valeur
                    example: D22
                  date_valeur:
                    type: string
                    x-stoplight:
                      id: n46miuipk8svp
                    description: Date d'effet de la valeur
                    example: 18/03/2024
                  type_valeur:
                    type: string
                    x-stoplight:
                      id: 17gpabcm2adch
                    example: vi
                    description: Type de la valeur
                  valeur:
                    type: string
                    x-stoplight:
                      id: soplj7kcf5lqe
                    description: 'Valeur de l''indicateur à cette date, zone'
                    example: '24.7'
                required:
                  - zone_id
                  - date_valeur
                  - type_valeur
                  - valeur
        description: Ensemble des données indicateurs à ajouter.
components:
  schemas:
    Chantier:
      title: Chantier
      x-stoplight:
        id: p5jtbeh5h8v1h
      type: object
      description: Description complète d'un chantier prioritaire.
      examples:
        - id: CH-001
          description: Description textuelle du premier chantier
          nom: Premier chantier prioritaire
          directeur_projet: Jean Dupont
          ppg_id: PPG-123
          porteurs: MEFSIN | MSAPH
          perimetre_id: PER-019
          territorialise: true
          engagement: EMPLOI
          etat: PUBLIE
      properties:
        id:
          type: string
          description: Identifiant du chantier
          pattern: '^CH-[0-9][0-9][0-9]$'
        description:
          type: string
          x-stoplight:
            id: zdi3an2y785p5
          description: Description du chantier
        nom:
          type: string
          x-stoplight:
            id: cyz7ea8cxcy1a
          description: Nom du chantier
        directeur_projet:
          type: string
          x-stoplight:
            id: r49po0dyvgn0n
          description: Nom du directeur de projet
        ppg_id:
          x-stoplight:
            id: ztoyprmidlw0v
          description: Identifiant de la PPG
          type: string
          pattern: '^PPG-[0-9][0-9][0-9]$'
          example: PPG-001
        porteurs:
          type: string
          x-stoplight:
            id: zyifvj48w8g4s
          description: Liste des porteurs du chantier (séparés par " | ").
          example: MEFSIN | MSAPH
        perimetre_id:
          type: string
          x-stoplight:
            id: q2f4thq23mxe4
          example: PER-019
          pattern: '^PER-[0-9][0-9][0-9]$'
          description: Identifiant du périmètre du chantier
        territorialise:
          type: boolean
          x-stoplight:
            id: osknraxgj0nzn
          description: Etat de territorialisation du chantier (Oui/non)
        engagement:
          type: string
          x-stoplight:
            id: tx1xg9r1jx1e3
          enum:
            - EMPLOI
            - PROGRES
            - TE
            - ENGAG
          example: EMPLOI
          description: Engagement auquel appartient le chantier
        etat:
          type: string
          x-stoplight:
            id: r5xhoq4owsiaw
          enum:
            - PUBLIE
            - BROUILLON
            - NON_PUBLIE
          example: PUBLIE
          description: Etat de publication du chantier
      required:
        - id
        - description
        - nom
        - ppg_id
        - perimetre_id
        - territorialise
        - etat
      x-tags:
        - Chantier
    PPG:
      title: PPG
      x-stoplight:
        id: y5p9457oy9ahb
      type: object
      examples:
        - id: PPG-014
          nom: Première PPG
          description: Description de la PPG
          axe_id:
            id: EMPLOI
      properties:
        id:
          type: string
          description: Identifiant de la PPG
          pattern: '^PPG-[0-9][0-9][0-9]$'
          example: PPG-014
        nom:
          type: string
          x-stoplight:
            id: 38z6p01nyhsyz
          example: Mieux vivre de son travail
        description:
          type: string
          x-stoplight:
            id: q86g1ouyl59k9
        axe_id:
          $ref: '#/components/schemas/Axe'
          x-stoplight:
            id: 4tdqltir7n7y4
      required:
        - id
        - nom
      description: Politique Prioritaire du Gouvernement
    Axe:
      title: Axe
      x-stoplight:
        id: pkmunivqndbww
      type: object
      properties:
        id:
          type: string
          example: EMPLOI
    Indicateur:
      title: Indicateur
      x-stoplight:
        id: dso2wkhwfj33t
      type: object
      properties:
        id:
          type: string
  securitySchemes:
    abc-123:
      name: X-API-KEY
      type: apiKey
      in: header
      description: Cette clé d'API vous permet de vous authentifier et d'aacéder uniquement aux resources autorisées.
  parameters:
    chantier_id:
      name: chantier_id
      in: query
      schema:
        type: string
        pattern: bla
      description: Identifiant de chantier
      required: true
tags:
  - name: Chantier
    description: Opérations sur les chantiers prioritaires
  - name: Indicateur
    description: Opérations sur les indicateurs des chantiers prioritaires
  - name: PPG
    description: Opérations sur les PPG (Politiques Prioritaires du Gouvernement)
  - name: WIP
    description: Développements en cours
x-internal: false
